<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Variant 1 Image</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="variant.css">
</head>

<body>
    <div id="iteration-number" class="iteration-number">#0001</div>
    <div id="variant-text" class="variant-text"></div>
    <div id="image-container" class="variant-img"></div>
    <script>
        // Function to update the view
        function updateVariant1View() {
            const variant1Text = localStorage.getItem('variant1_text') || '';
            const img1 = localStorage.getItem('variant1_img');

            console.log('üîç VARIANT1: Displaying summary text:', variant1Text);

            // Update iteration number based on history length
            const history = JSON.parse(localStorage.getItem('history') || '[]');
            const iterationNumber = history.length + 1;
            const formattedNumber = iterationNumber.toString().padStart(4, '0');
            document.getElementById('iteration-number').textContent = `#${formattedNumber}`;

            // Show the summary text (which includes instruction)
            document.getElementById('variant-text').innerHTML = variant1Text.replace(/\n/g, '<br>');
            if (img1) {
                document.getElementById('image-container').innerHTML = `<img src="${img1}" alt="Variant 1 Image">`;
            } else {
                document.getElementById('image-container').innerHTML = `
                    <div class="loading-container">
                        <div class="loading-text">Mutation incoming...</div>
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                    </div>
                `;
            }
        }
        updateVariant1View();

        // Check for updates every few seconds in case instruction gets saved later
        setInterval(() => {
            updateVariant1View();
        }, 3000);

        // Function to show vote animation
        function showVoteAnimation() {
            // Remove any existing animation
            const existingFeedback = document.querySelector('.vote-feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }

            // Create new animation element
            const feedback = document.createElement('div');
            feedback.className = 'vote-feedback variant1';
            feedback.textContent = '+1';
            document.body.appendChild(feedback);

            // Remove the element after animation completes
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
            }, 1800);
        }

        // Listen for vote events from main page
        window.addEventListener('storage', function (e) {
            if (e.key === 'variant1_img' || e.key === 'variant1_desc' || e.key === 'variant1_text' || e.key === 'history') {
                updateVariant1View();
            }

            // Check for vote trigger
            if (e.key === 'variant1_vote_trigger') {
                showVoteAnimation();
                // Clear the trigger
                localStorage.removeItem('variant1_vote_trigger');
            }
        });

        // Also listen for custom events (for same-page communication)
        window.addEventListener('message', function (e) {
            if (e.data && e.data.type === 'variant1_vote') {
                showVoteAnimation();
            }
        });

        // DEBUG: Test button (remove this in production)
        document.addEventListener('keydown', function (e) {
            if (e.key === '1') {
                showVoteAnimation();
            }
        });
    </script>
</body>

</html>